name: 01_Auto_Train_and_Register

on:
  push:
    paths: ["src/**"]

jobs:
  train:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Install Azure ML CLI
        run: |
          az extension add -n ml --yes
          az config set extension.dynamic_install_allow_preview=true

      - name: Configure Azure ML
        run: |
          az configure --defaults \
            group=${{ secrets.AZURE_RESOURCE_GROUP }} \
            workspace=${{ secrets.AZURE_WORKSPACE }}

      - name: Verify Azure Setup
        run: |
          echo "✅ Azure connection successful"
          az version
          az ml workspace list --max-results 1

      # - name: Run Job
      #   run: |
      #     JOB_NAME=$(az ml job create --file azureml/train-job.yml --query name -o tsv)
      #     echo "JOB_NAME=$JOB_NAME" >> $GITHUB_ENV
      #     echo "시작된 Job 이름: $JOB_NAME"
      #     az ml job show --name $JOB_NAME --wait

      # - name: Register Model
      #   run: |
      #     az ml model create --name model \
      #       --path azureml://jobs/${{ env.JOB_NAME }}/outputs/artifacts/paths/outputs/ \
      #       --type custom_model
